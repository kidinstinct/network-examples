---
- name: Configure Nexus 9000 switches
  hosts: dc1_leafs
  gather_facts: false

  tasks:
    - name: Gather VLAN information
      cisco.nxos.nxos_facts:
        gather_subset:
          - '!all'
          - '!hardware'
          - '!min'
        gather_network_resources:
          - vlans
      register: output

    - name: Store VLAN facts to file
      ansible.builtin.copy:
        content: '{{ ansible_network_resources | to_nice_yaml }}'
        dest: '{{ playbook_dir }}/vlan_facts.yml'
        mode: '0644'

    # - name: Enable bgp feature
    #   cisco.nxos.nxos_feature:
    #     feature: bgp
    #     state: enabled
    #   register: output

    # - name: Configure bgp
    #   cisco.nxos.nxos_bgp_global:
    #     config:
    #       as_number: 65000
    #       router_id: "{{ hostvars[inventory_hostname]['ansible_host'] }}"
    #       log_neighbor_changes: true
    #       bestpath:
    #         as_path:
    #           multipath_relax: true
    #         cost_community_ignore: true
    #         compare_routerid: true
    #         always_compare_med: true
    #         compare_neighborid: true
    #         med:
    #           missing_as_worst: true
    #       graceful_restart:
    #         helper: true
    #         restart_time: 120
    #         set: true
    #         stalepath_time: 360
    #     state: merged
    #   register: output

    # - name: Save running configuration to startup configuration and backup
    #   cisco.nxos.nxos_config:
    #     backup: true
    #     save_when: modified
    #   register: output

    - name: Print output
      ansible.builtin.debug:
        var: output
